generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  role      Role     @default(ABOGADO)
  casos     Caso[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Caso {
  id              String     @id @default(cuid())
  userId          String
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  audioKey        String?
  transcription   String?    @db.Text
  
  documentType    String?
  aiModel         String?
  
  status          CasoStatus @default(TRANSCRIBIENDO)
  
  extractedData   Json?
  
  documentos      Documento[]
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
}

model Documento {
  id          String          @id @default(cuid())
  casoId      String
  caso        Caso            @relation(fields: [casoId], references: [id], onDelete: Cascade)
  
  tipo        String
  plantillaId String?
  plantilla   Plantilla?      @relation(fields: [plantillaId], references: [id])
  
  contenido   String          @db.Text
  status      DocumentoStatus @default(BORRADOR)
  version     Int             @default(1)
  
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model Plantilla {
  id          String      @id @default(cuid())
  nombre      String
  tipo        String      @unique
  contenido   String      @db.Text
  campos      Json
  documentos  Documento[]
  activa      Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

enum Role {
  ABOGADO
  ADMIN
}

enum CasoStatus {
  TRANSCRIBIENDO
  CLASIFICANDO
  EXTRAYENDO_INFO
  REQUIERE_INFO
  GENERANDO_DOCUMENTO
  EN_REVISION
  COMPLETADO
  ERROR
}

enum DocumentoStatus {
  BORRADOR
  EN_REVISION
  APROBADO
  IMPRESO
}